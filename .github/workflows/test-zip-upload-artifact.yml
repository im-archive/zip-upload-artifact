name: Test Zip Upload Artifact

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - name: Create Test Files
      shell: python
      run: |
        import os

        def create_file(path_file):
          two_mb = 2 * 1024 * 1024
          print(f"Create file at: {path_file}")
          with open(path_file, "w") as writer:
            writer.write("*" * two_mb)

        dir_results = "test_results"
        os.mkdir(dir_results)

        path_file_0 = "file_0.txt"
        create_file(path_file_0)

        path_file_1 = os.path.join(dir_results, "file_1.txt")
        create_file(path_file_1)

        path_file_2 = os.path.join(dir_results, "file_2.txt")
        create_file(path_file_2)

    - name: Directory With Files
      if: always()
      uses: im-open/zip-upload-artifact@v1
      with:
        name: Directory With Text Files
        path: test_results
        retention-days: '3'

    - name: Single File in a Directory
      if: always()
      uses: im-open/zip-upload-artifact@v1
      with:
        name: Single Text File in Directory
        path: test_results/file_1.txt
        retention-days: '3'

    - name: Single File at Root Directory
      if: always()
      uses: im-open/zip-upload-artifact@v1
      with:
        name: Single Test File at Root Directory
        path: file_0.txt
        retention-days: '3'
